# Google Tag Manager (GTM) 設定ガイド

## 概要
このガイドでは、TOPページのユーザー行動を計測するためのGTM設定方法を説明します。

## 計測可能なイベント

### 1. クリックイベント
- **公式サイトリンク**: クリニックの公式サイトへの遷移
- **詳細を見るボタン**: クリニック詳細へのスクロール
- **ランキングクリニック**: ランキング内のクリニッククリック
- **Tipsタブ**: 医療痩身の効果、クリニック選び、今がおすすめ
- **比較表タブ**: 総合、施術内容、サービス
- **ハンバーガーメニュー**: メニューの開閉
- **フッターリンク**: 各種ページへの遷移

### 2. フィルター・検索イベント
- **地域選択**: 地域フィルターの変更
- **クリニック名検索**: 検索キーワードの入力

### 3. エンゲージメントイベント
- **スクロール深度**: 25%, 50%, 75%, 90%, 100%
- **滞在時間**: 10秒, 30秒, 60秒, 120秒, 180秒

## GTMでの設定手順

### ステップ1: 変数の作成

1. GTMダッシュボードにログイン
2. 「変数」→「新規」をクリック
3. 以下の変数を作成：

#### データレイヤー変数
- **変数名**: DL - Event Category
- **変数タイプ**: データレイヤーの変数
- **データレイヤー変数名**: eventCategory

- **変数名**: DL - Event Action
- **変数タイプ**: データレイヤーの変数
- **データレイヤー変数名**: eventAction

- **変数名**: DL - Event Label
- **変数タイプ**: データレイヤーの変数
- **データレイヤー変数名**: eventLabel

- **変数名**: DL - Event Value
- **変数タイプ**: データレイヤーの変数
- **データレイヤー変数名**: eventValue

### ステップ2: トリガーの作成

1. 「トリガー」→「新規」をクリック
2. 以下のトリガーを作成：

#### カスタムイベントトリガー
- **トリガー名**: Custom Event - All
- **トリガータイプ**: カスタムイベント
- **イベント名**: customEvent
- **このトリガーの発生場所**: すべてのカスタムイベント

### ステップ3: タグの作成

#### Google Analytics 4 イベントタグ
1. 「タグ」→「新規」をクリック
2. タグの設定：
   - **タグタイプ**: Google アナリティクス: GA4 イベント
   - **設定タグ**: [既存のGA4設定タグを選択]
   - **イベント名**: {{DL - Event Action}}
   - **イベントパラメータ**:
     - event_category: {{DL - Event Category}}
     - event_label: {{DL - Event Label}}
     - value: {{DL - Event Value}}

3. トリガー：
   - Custom Event - All

### ステップ4: プレビューとテスト

1. GTMの「プレビュー」ボタンをクリック
2. サイトを開いて各アクションを実行
3. Tag Assistantでイベントが正しく発火することを確認

### ステップ5: 公開

1. テストが完了したら「送信」をクリック
2. バージョン名と説明を入力
3. 「公開」をクリック

## Google Analytics 4での確認

1. GA4の「リアルタイム」レポートを開く
2. 「イベント」セクションでイベントが記録されているか確認
3. 「イベント」→「すべてのイベント」で詳細なデータを確認

## カスタムレポートの作成

### 推奨レポート
1. **クリニック別クリック数**: どのクリニックが人気か
2. **タブ切り替え分析**: ユーザーが興味を持つコンテンツ
3. **スクロール深度分析**: ページのどこまで読まれているか
4. **地域別分析**: どの地域からのアクセスが多いか

## トラブルシューティング

### イベントが記録されない場合
1. ブラウザのコンソールでエラーを確認
2. GTMプレビューモードで変数の値を確認
3. dataLayerにイベントが正しくプッシュされているか確認

### 重複イベントが発生する場合
1. 同じトリガーが複数設定されていないか確認
2. タグの発火条件を見直す

## 注意事項
- 個人情報を含むデータは送信しない
- イベント名は分かりやすく一貫性のあるものにする
- 定期的にデータを確認し、異常がないかチェックする