<!DOCTYPE html>
<html>
<head>
    <title>Debug Store View Logic</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .region-section { margin: 30px 0; border: 2px solid #333; padding: 20px; }
    </style>
</head>
<body>
    <h1>Store View Logic Debug</h1>
    <div id="output"></div>
    
    <script src="data-manager.js"></script>
    <script>
        async function debugStoreView() {
            const dataManager = new DataManager();
            await dataManager.init();
            
            const output = document.getElementById('output');
            let html = '';
            
            // Test specific regions
            const testRegions = ['001', '013'];
            
            for (const regionId of testRegions) {
                html += '<div class="region-section">';
                html += '<h2>Region: ' + regionId + '</h2>';
                
                // Get ranking
                const ranking = dataManager.getRankingByRegionId(regionId);
                html += '<h3>1. Ranking Data (どのクリニックがどの順位か)</h3>';
                html += '<table>';
                html += '<tr><th>Position</th><th>Clinic ID</th><th>Clinic Name</th></tr>';
                
                if (ranking) {
                    Object.entries(ranking.ranks).forEach(([position, clinicId]) => {
                        const clinic = dataManager.clinics.find(c => c.id === clinicId);
                        html += '<tr>';
                        html += '<td>' + position + '</td>';
                        html += '<td>' + clinicId + '</td>';
                        html += '<td>' + (clinic ? clinic.name : 'Unknown') + '</td>';
                        html += '</tr>';
                    });
                }
                html += '</table>';
                
                // Get store view data
                const storeView = dataManager.storeViews.find(sv => sv.regionId === regionId);
                html += '<h3>2. Store View Data (どのクリニックのどの店舗を表示するか)</h3>';
                html += '<table>';
                html += '<tr><th>Clinic Column</th><th>Clinic Name</th><th>Store IDs</th></tr>';
                
                if (storeView) {
                    for (let i = 1; i <= 5; i++) {
                        const clinicKey = 'clinic_' + i;
                        const clinic = dataManager.clinics.find(c => c.id === String(i));
                        const storeIds = storeView.clinicStores[clinicKey] || [];
                        
                        html += '<tr>';
                        html += '<td>' + clinicKey + '</td>';
                        html += '<td>' + (clinic ? clinic.name : 'Unknown') + '</td>';
                        html += '<td>' + (storeIds.length > 0 ? storeIds.join(', ') : '-') + '</td>';
                        html += '</tr>';
                    }
                }
                html += '</table>';
                
                // Get actual stores
                const stores = dataManager.getStoresByRegionId(regionId);
                html += '<h3>3. 実際に取得された店舗 (getStoresByRegionId結果)</h3>';
                html += '<table>';
                html += '<tr><th>Store ID</th><th>Clinic Name</th><th>Store Name</th></tr>';
                
                stores.forEach(store => {
                    html += '<tr>';
                    html += '<td>' + store.id + '</td>';
                    html += '<td>' + store.clinicName + '</td>';
                    html += '<td>' + store.name + '</td>';
                    html += '</tr>';
                });
                
                if (stores.length === 0) {
                    html += '<tr><td colspan="3">No stores found</td></tr>';
                }
                html += '</table>';
                
                html += '</div>';
            }
            
            output.innerHTML = html;
        }
        
        debugStoreView();
    </script>
</body>
</html>