# 統合テストシナリオ集

作成者: Worker3
作成日時: 2025-07-17 12:20
対象システム: 地域別クリニックランキングサイト + CSV管理画面

## テストシナリオ概要

本ドキュメントは、統合テストで実施する具体的なテストシナリオを定義します。
各シナリオは実際のユーザー操作を模倣し、システム全体の動作を検証します。

## シナリオ1: 初回データセットアップ

### 目的
新規環境で全てのCSVファイルをアップロードし、ランキングサイトに反映させる

### 前提条件
- 管理画面にアクセス可能
- CSVファイルが準備済み
- フロントエンドが起動済み

### 手順
1. 管理画面（http://localhost:8002）にアクセス
2. 以下の順序でCSVファイルをドラッグ&ドロップ
   - 出しわけSS - region.csv
   - 出しわけSS - items.csv
   - 出しわけSS - ranking.csv
   - 出しわけSS - stores.csv
   - 出しわけSS - store_view.csv
3. 各ファイルのアップロード完了を確認
4. 「データ検証」ボタンをクリック
5. 検証結果が「問題なし」であることを確認
6. 「保存」ボタンをクリック
7. フロントエンド（http://localhost:8000）を開く
8. 地域選択で「東京」を選択
9. ランキングが正しく表示されることを確認

### 期待結果
- 全ファイルが正常にアップロード
- データ検証で問題なし
- フロントエンドでランキング表示

### 検証項目
- [ ] アップロードプログレスバーが100%
- [ ] ファイル情報（サイズ、レコード数）が表示
- [ ] 統計情報が更新される
- [ ] データ検証が成功
- [ ] フロントエンドに反映

## シナリオ2: 部分データ更新

### 目的
既存データの一部を更新し、変更が正しく反映されることを確認

### 前提条件
- シナリオ1完了済み
- 更新用CSVファイル準備済み

### 手順
1. 管理画面にアクセス
2. 現在のデータでバックアップを作成
3. ランキングデータ（ranking.csv）のみ更新版をアップロード
4. データ検証を実行
5. 保存を実行
6. フロントエンドでランキング順位の変更を確認

### 期待結果
- 部分更新が成功
- 他のデータは保持される
- フロントエンドに即座に反映

### 検証項目
- [ ] バックアップ作成成功
- [ ] 単一ファイル更新成功
- [ ] 他のデータが影響を受けない
- [ ] フロントエンドの表示更新

## シナリオ3: エラーリカバリー

### 目的
エラー発生時の適切なハンドリングとリカバリー手順を確認

### 前提条件
- 正常なデータがアップロード済み
- エラーテスト用ファイル準備済み

### 手順
1. 不正な形式のCSVファイルをアップロード試行
2. エラーメッセージを確認
3. 10MB超の大容量ファイルをアップロード試行
4. エラーメッセージを確認
5. ネットワーク切断状態でデータ保存を試行
6. エラー後、正常なファイルで再試行

### 期待結果
- エラーが適切に表示される
- システムが停止しない
- 再試行で正常動作

### 検証項目
- [ ] ファイル形式エラーの検出
- [ ] サイズ制限エラーの検出
- [ ] ネットワークエラーのハンドリング
- [ ] エラー後の正常動作

## シナリオ4: 同時アクセス

### 目的
複数ユーザーが同時にアクセスした場合の動作を確認

### 前提条件
- 複数のブラウザタブまたはウィンドウ
- テストデータ準備済み

### 手順
1. 3つのブラウザタブで管理画面を開く
2. タブ1: 地域データをアップロード
3. タブ2: クリニックデータをアップロード（同時）
4. タブ3: データ検証を実行（同時）
5. 全ての操作が完了するまで待機
6. 各タブでデータの整合性を確認

### 期待結果
- 同時操作でもエラーなし
- データの整合性維持
- 適切な排他制御

### 検証項目
- [ ] 同時アップロード成功
- [ ] データ競合なし
- [ ] UIの応答性維持
- [ ] エラーメッセージなし

## シナリオ5: バックアップと復元

### 目的
バックアップ機能の完全性と復元機能の信頼性を確認

### 前提条件
- 正常なデータセットアップ済み
- 複数のバックアップ作成済み

### 手順
1. 現在のデータ状態を記録
2. 「バックアップ作成」ボタンをクリック
3. バックアップリストに追加されることを確認
4. データを意図的に変更または削除
5. バックアップリストから復元を実行
6. 元のデータ状態に戻ることを確認
7. フロントエンドでも確認

### 期待結果
- バックアップが正確に作成
- 復元で完全に元に戻る
- メタデータも復元

### 検証項目
- [ ] バックアップ作成時刻記録
- [ ] バックアップサイズ正確
- [ ] 復元後のデータ一致
- [ ] フロントエンド表示確認

## シナリオ6: パフォーマンステスト

### 目的
大量データ処理時のパフォーマンスを確認

### 前提条件
- 大容量テストデータ準備
- パフォーマンス測定ツール準備

### 手順
1. 1000件のクリニックデータをアップロード
2. アップロード時間を測定
3. 5000件の店舗データをアップロード
4. データ検証時間を測定
5. 保存処理時間を測定
6. フロントエンドのレスポンス時間測定

### 期待結果
- 各処理が目標時間内に完了
- メモリ使用量が適切
- UIがフリーズしない

### 検証項目
- [ ] 1000件処理: 5秒以内
- [ ] 5000件処理: 20秒以内
- [ ] データ検証: 3秒以内
- [ ] フロントエンド表示: 1秒以内

## シナリオ7: セキュリティ検証

### 目的
セキュリティ対策の有効性を確認

### 前提条件
- セキュリティテストツール準備
- 攻撃パターンファイル準備

### 手順
1. XSSペイロードを含むCSVをアップロード
2. SQLインジェクションパターンを含むデータを送信
3. 不正なファイルパスを指定してアクセス
4. 大量リクエストでDoS攻撃をシミュレート
5. セッションハイジャックを試行

### 期待結果
- 全ての攻撃が防御される
- システムが正常動作を維持
- 適切なログ記録

### 検証項目
- [ ] XSS攻撃の無害化
- [ ] SQLインジェクション防御
- [ ] パストラバーサル防御
- [ ] レート制限機能
- [ ] セッション管理

## シナリオ8: エンドツーエンドテスト

### 目的
実際の運用フローを完全に再現し、全体的な動作を確認

### 前提条件
- クリーンな環境
- 本番相当のデータセット

### 手順
1. 管理者として管理画面にログイン（実装時）
2. 全CSVファイルを順次アップロード
3. データ検証と保存
4. バックアップ作成
5. フロントエンドで全地域の表示確認
6. データを部分更新
7. フロントエンドで更新確認
8. バックアップから復元
9. ログアウト

### 期待結果
- 全フローが滞りなく完了
- データの一貫性維持
- ユーザー体験が良好

### 検証項目
- [ ] ログイン機能（実装時）
- [ ] 完全なデータライフサイクル
- [ ] UI/UXの一貫性
- [ ] エラーなし
- [ ] パフォーマンス基準達成

## テスト実施記録テンプレート

```markdown
## シナリオ[番号]: [シナリオ名]
実施日時: YYYY-MM-DD HH:MM
実施者: Worker3
環境: [テスト環境の詳細]

### 実施結果
- 全体結果: PASS / FAIL
- 所要時間: XX分XX秒

### 詳細結果
| ステップ | 結果 | 備考 |
|----------|------|------|
| 1. XXX | PASS | |
| 2. XXX | PASS | |
| 3. XXX | FAIL | エラー内容: XXX |

### 発見した問題
1. [問題の詳細]
2. [問題の詳細]

### 改善提案
1. [提案内容]
2. [提案内容]

### スクリーンショット
[必要に応じて添付]
```

## 次のステップ
1. Worker2の実装完了待ち（13:30）
2. テスト環境のセットアップ
3. シナリオ順次実行
4. 結果記録と報告